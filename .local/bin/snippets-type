#!/bin/bash


OS="$(uname -s)"

if [[ "${OS}" == "Linux"* ]]; then

  if pgrep -x "tofi"; then
    wtype -k ESCAPE
    exit 0
  else
    hypr-switch-en
    wtype "$(grep -v '^#' ~/.local/src/datagrip/snippets | tofi | awk -F ' #' '{print $1}' )"
    #ydotool type -d 0 -D 0 -H 0 "$(grep -v '^#' ~/.local/src/datagrip/snippets | tofi | awk -F ' #' '{print $1}' )"
    #ydotool type "$(grep -v '^#' ~/.local/src/datagrip/snippets | dmenu -i -l 50)"
    #wtype "$(grep -v '^#' ~/.local/src/datagrip/snippets | wofi --dmenu -i -W 1900 -M fuzzy)"
  fi

elif [[ "${OS}" == "Darwin"* ]]; then

  previous_app=$(osascript -e 'tell application "System Events" to get name of first application process whose frontmost is true')

  /opt/homebrew/bin/rg -v '^#' ~/.local/src/datagrip/snippets | grep -v "^$" | $HOME/.local/bin/dmenu-raycast | awk -F ' #' '{printf "%s", $1}' | pbcopy -

  #/opt/homebrew/bin/rg -v '^#' ~/.local/src/datagrip/snippets | /opt/homebrew/bin/choose -w 80% -n 20 -u -z -b fabd2f -c 427b58 -s 17 <&0 | pbcopy -

# Возвращаем фокус к предыдущему приложению
osascript <<EOF
tell application "$previous_app"
    activate
end tell
tell application "System Events"
            keystroke "v" using command down
end tell
EOF

fi
